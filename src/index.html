<!-- 
 Copyright (C) 2025 KaedeharaLu
 依据 GNU 通用公共许可证 v3.0 授权
 请参阅 LICENSE 文件了解详细信息 
-->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人主页</title>
    <meta name="description" content="个人引导页面,您可以从这里访问到我的所有公开服务">
    <meta name="keywords" content="个人主页,个人引导页">
    <link rel="icon" type="image/ico" href="assets/images/favicon.ico">
    <script src="https://unpkg.com/vue@3.5.18/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios@1.11.0/dist/axios.min.js"></script>
    <!-- 如果Vue和axios库下载失败，则加载备份文件 -->
    <script>
        if (typeof Vue === 'undefined') {
            document.write('<script src="/assets/js/vue@3.5.18.global.js"><\/script>');
        }
        if (typeof axios === 'undefined') {
            document.write('<script src="/assets/js/axios@1.11.0.min.js"><\/script>');
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Roboto+Mono:wght@300;400;500&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #6a5acd;
            --secondary-color: #9370db;
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --text-color: #e6e6ff;
            --accent-color: #4cc9f0;
            --success-color: #4ade80;
            --warning-color: #fbbf24;
            --error-color: #f87171;
            --border-radius: 12px;
            --box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, var(--bg-color) 0%, #0f3460 100%);
            color: var(--text-color);
            min-height: 100vh;
            padding: 0px;
            line-height: 1.6;
            margin: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* 修改主内容布局 */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
            flex: 1;
        }

        @media (min-width: 992px) {
            .main-content {
                flex-direction: row;
                align-items: flex-start;
                /* 添加此属性防止等高 */
            }

            /* 修改左侧列宽度为45% */
            .left-column {
                width: 45%;
                flex-shrink: 0;
                display: flex;
                flex-direction: column;
                padding-right: 20px;
                height: auto;
                /* 确保高度自适应 */
            }

            /* 修改右侧列宽度为55% */
            .right-column {
                width: 55%;
                position: relative;
                display: flex;
                flex-direction: column;
            }
        }

        /* 头部样式 */
        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 0;
        }

        /* 标题样式 */
        .logo-container {
            text-align: center;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .logo {
            font-size: 3.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--accent-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 1.5px;
            text-shadow: 0 4px 10px rgba(76, 201, 240, 0.2);
            display: block;
        }

        .subtitle {
            font-size: 1.5rem;
            font-weight: 300;
            font-style: italic;
            opacity: 0.85;
            margin: 0 auto;
            padding: 0 20px;
            margin-top: 15px;
        }

        /* 头像样式 */
        .profile-avatar {
            width: 150px;
            height: 150px;
            border: 2px solid white;
            border-radius: 5px;
            object-fit: cover;
            margin: 0 auto;
            display: block;
        }

        /* 当前时间样式 - 修改布局 */
        .current-time {
            background: rgba(26, 26, 46, 0.7);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            padding: 25px;
            margin: 20px 0;
            box-shadow: var(--box-shadow);
            border: 1px solid rgba(106, 90, 205, 0.3);
            flex-grow: 0;
            /* 防止时间容器过度拉伸 */
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .current-time-title {
            text-align: center;
            font-size: 1.6rem;
            margin-bottom: 25px;
            font-weight: 500;
            color: var(--accent-color);
        }

        .current-time-container {
            display: flex;
            justify-content: space-around;
            gap: 20px;
        }

        .current-time-item {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }

        .current-time-value {
            font-size: 3.5rem;
            font-family: 'Roboto Mono', monospace;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1;
            margin-bottom: 5px;
        }

        .current-time-label {
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            opacity: 0.7;
        }

        /* 社交链接样式 - 修改为网格布局 */
        .social-links {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px 0;
            margin-top: auto;
            /* 社交链接推到左侧列底部 */
            padding-top: 20px;
            /* 添加顶部间隔 */
        }

        .social-link {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--text-color);
            transition: all 0.3s ease;
            padding: 15px 10px;
            background: rgba(22, 33, 62, 0.5);
            border-radius: 10px;
            border: 1px solid rgba(106, 90, 205, 0.2);
        }

        .social-link:hover {
            transform: translateY(-5px);
            background: rgba(106, 90, 205, 0.2);
            border-color: var(--accent-color);
        }

        .social-icon {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }

        .social-name {
            font-size: 0.95rem;
        }

        /* 留言板样式 */
        .comments-section {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            border: 1px solid rgba(106, 90, 205, 0.3);
            flex-grow: 1;
        }

        .section-title {
            font-size: 2rem;
            margin-bottom: 30px;
            text-align: center;
            color: var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            cursor: pointer;
        }

        .section-title i {
            font-size: 1.8rem;
            transition: transform 0.3s ease;
        }

        .section-title.collapsed i {
            transform: rotate(180deg);
            /* 折叠时箭头向上 */
        }

        .comment-form-container {
            max-height: 1000px;
            /* 初始展开状态 */
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .comment-form-container.collapsed {
            max-height: 0;
        }

        .comment-form {
            background: rgba(26, 26, 46, 0.6);
            border-radius: var(--border-radius);
            padding: 25px;
            border: 1px solid rgba(106, 90, 205, 0.3);
        }

        .comments-list {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
            margin-bottom: 30px;
        }

        /* 滚动条样式 */
        .comments-list::-webkit-scrollbar {
            width: 8px;
        }

        .comments-list::-webkit-scrollbar-track {
            background: rgba(26, 26, 46, 0.5);
            border-radius: 4px;
        }

        .comments-list::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }

        .comment {
            background: rgba(26, 26, 46, 0.6);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            border-left: 3px solid var(--primary-color);
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .comment-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 15px;
            border: 2px solid var(--primary-color);
        }

        .user-info {
            flex: 1;
        }

        .username {
            font-weight: 600;
            font-size: 1.2rem;
            margin-bottom: 3px;
        }

        .blog-link {
            font-size: 0.9rem;
            color: var(--accent-color);
            text-decoration: none;
        }

        .blog-link:hover {
            text-decoration: underline;
        }

        .comment-content {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 15px;
            padding: 0 10px;
        }

        .comment-time {
            text-align: right;
            font-size: 0.85rem;
            color: rgba(230, 230, 255, 0.7);
            font-style: italic;
        }

        .loading {
            text-align: center;
            padding: 30px;
            font-size: 1.2rem;
        }

        .loading i {
            font-size: 2rem;
            margin-bottom: 15px;
            color: var(--accent-color);
            display: block;
        }

        .error {
            text-align: center;
            padding: 30px;
            background: rgba(248, 113, 113, 0.15);
            border-radius: var(--border-radius);
            color: var(--error-color);
        }

        /* 留言表单样式 */
        .comment-form {
            background: rgba(26, 26, 46, 0.6);
            border-radius: var(--border-radius);
            padding: 25px;
            border: 1px solid rgba(106, 90, 205, 0.3);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(22, 33, 62, 0.8);
            border: 1px solid rgba(106, 90, 205, 0.3);
            border-radius: 8px;
            color: var(--text-color);
            font-family: inherit;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .submit-btn {
            display: block;
            width: 100%;
            padding: 14px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.3s, opacity 0.3s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }

        .submit-btn:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
            opacity: 0.7;
        }

        .form-error {
            color: var(--error-color);
            font-size: 0.9rem;
            margin-top: 5px;
            display: block;
        }

        .success-message {
            text-align: center;
            padding: 15px;
            background: rgba(76, 222, 128, 0.15);
            border-radius: var(--border-radius);
            color: var(--success-color);
            margin-top: 20px;
            animation: fadeIn 0.5s;
        }

        .avatar-preview {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid var(--primary-color);
            margin-top: 10px;
            object-fit: cover;
            background-color: #2c2c54;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .avatar-preview i {
            font-size: 24px;
            color: var(--secondary-color);
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-col {
            flex: 1;
        }

        /* 页脚样式 - 移动到页面底部 */
        footer {
            /* position: relative; */
            width: 100%;
            text-align: center;
            padding: 30px 0;
            font-size: 0.9rem;
            opacity: 0.7;
            /* margin-top: 40px; */
            margin-top: auto;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .logo {
                font-size: 2.8rem;
            }

            .subtitle {
                font-size: 1.2rem;
            }

            .current-time-container {
                gap: 15px;
            }

            .current-time-value {
                font-size: 2.5rem;
            }

            .social-links {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 480px) {
            .logo {
                font-size: 2.3rem;
            }

            .current-time-container {
                gap: 10px;
            }

            .current-time-value {
                font-size: 2rem;
            }

            .current-time-label {
                font-size: 0.9rem;
            }

            .social-links {
                grid-template-columns: repeat(2, 1fr);
            }

            .social-icon {
                font-size: 2rem;
            }
        }

        /* 新增：在宽屏时调整布局 */
        @media (min-width: 992px) and (max-width: 1199px) {
            .current-time-value {
                font-size: 3rem;
            }
        }

        footer a {
            color: var(--text-color);
            text-decoration: none;
        }

        footer a:hover {
            color: var(--accent-color);
            text-decoration: none;
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="container">
            <div class="main-content">
                <!-- 左侧列：头像、标题、一言、时间、社交链接 -->
                <div class="left-column">
                    <img src="assets/images/avatar.jpg" alt="头像" class="profile-avatar desktop-avatar">

                    <!-- 标题容器 -->
                    <div class="logo-container">
                        <h1 class="logo">{{ siteConfig.name }}</h1>
                    </div>

                    <p class="subtitle" id="hitokoto"></p> <!-- 一言 -->

                    <div class="current-time">
                        <div class="current-time-container">
                            <div class="current-time-item">
                                <div class="current-time-value">{{ hours }}</div>
                                <div class="current-time-label">HOURS</div>
                            </div>
                            <div class="current-time-item">
                                <div class="current-time-value">{{ minutes }}</div>
                                <div class="current-time-label">MINUTES</div>
                            </div>
                            <div class="current-time-item">
                                <div class="current-time-value">{{ seconds }}</div>
                                <div class="current-time-label">SECONDS</div>
                            </div>
                        </div>
                    </div>

                    <!-- social-links -->
                    <div class="social-links">
                        <a v-for="(link, index) in siteConfig.socialLinks" :key="index" :href="link.url" class="social-link" target="_blank">
                            <i :class="link.icon + ' social-icon'"></i>
                            <span class="social-name">{{ link.name }}</span>
                        </a>
                    </div>
                </div>

                <!-- 右侧列：留言板 -->
                <div class="right-column">
                    <div class="comments-section">
                        <h2 class="section-title" @click="toggleCommentForm">
                            <i :class="commentFormCollapsed ? 'fas fa-chevron-down' : 'fas fa-chevron-up'"></i>
                            发表留言
                        </h2>

                        <!-- 留言表单容器 -->
                        <div class="comment-form-container" :class="{ 'collapsed': commentFormCollapsed }">
                            <div class="comment-form">
                                <div v-if="submitSuccess" class="success-message">
                                    <i class="fas fa-check-circle"></i> 留言提交成功！
                                </div>

                                <form @submit.prevent="submitComment">
                                    <div class="form-row">
                                        <div class="form-col">
                                            <div class="form-group">
                                                <label class="form-label">昵称 *</label>
                                                <input type="text" class="form-input" v-model="newComment.nickname"
                                                    placeholder="请输入您的昵称">
                                                <span v-if="errors.nickname" class="form-error">{{ errors.nickname }}</span>
                                            </div>

                                            <div class="form-group">
                                                <label class="form-label">博客/网站</label>
                                                <input type="url" class="form-input" v-model="newComment.blog"
                                                    placeholder="https://example.com">
                                            </div>
                                        </div>

                                        <div class="form-col">
                                            <div class="form-group">
                                                <label class="form-label">头像链接</label>
                                                <input type="url" class="form-input" v-model="newComment.avatar"
                                                    placeholder="https://example.com/avatar.jpg">
                                                <span v-if="errors.avatar" class="form-error">{{ errors.avatar }}</span>
                                            </div>

                                            <div class="avatar-preview">
                                                <img v-if="newComment.avatar" :src="newComment.avatar" alt="头像预览"
                                                    style="width:100%;height:100%;">
                                                <i v-else class="fas fa-user"></i>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">留言内容 *</label>
                                        <textarea class="form-input form-textarea" v-model="newComment.content"
                                            placeholder="请写下您的留言..."></textarea>
                                        <span v-if="errors.content" class="form-error">{{ errors.content }}</span>
                                    </div>

                                    <button type="submit" class="submit-btn" :disabled="submitting">
                                        <span v-if="!submitting">提交留言</span>
                                        <span v-else><i class="fas fa-spinner fa-spin"></i> 提交中...</span>
                                    </button>
                                </form>
                            </div>
                        </div>

                        <!-- 留言列表标题 -->
                        <h2 class="section-title">
                            <i class="fas fa-comments"></i>留言板
                        </h2>

                        <div v-if="loading" class="loading">
                            <i class="fas fa-spinner fa-spin"></i>
                            正在加载留言...
                        </div>

                        <div v-else-if="error" class="error">
                            <i class="fas fa-exclamation-triangle"></i>
                            <p>{{ error }}</p>
                        </div>

                        <div v-else class="comments-list">
                            <div v-if="comments.length!=0" v-for="comment in comments" :key="comment.id" class="comment">
                                <div class="comment-header">
                                    <img :src="comment.avatar || 'https://ui-avatars.com/api/?name=' + comment.nickname"
                                        :alt="comment.nickname" class="avatar">
                                    <div class="user-info">
                                        <div class="username">{{ comment.nickname }}</div>
                                        <a v-if="comment.blog" :href="comment.blog" target="_blank" class="blog-link">
                                            {{ comment.blog }}
                                        </a>
                                    </div>
                                </div>
                                <p class="comment-content">{{ comment.content }}</p>
                                <div class="comment-time">{{ formatTime(comment.time) }}</div>
                            </div>
                            <div v-else class="comment">
                                <div>还没有人留言哦~</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <footer>
                <p>Copyright © 2025 KaedeharaLu.All Rights Reserved. | <a href="https://github.com/KaedeharaLu/KalorsPage">KalorsPage</a> | <a href="https://www.chmlfrp.cn">ChmlFrp提供内网穿透服务</a></p>
            </footer>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted } = Vue

        createApp({
            setup() {
                const commentFormCollapsed = ref(true); // 默认折叠

                // 默认站点数据
                const siteConfig = ref({
                    name: 'HOMEPAGE',
                    title: '个人主页',
                    description: '个人引导页面',
                    keywords: '个人主页,个人引导页',
                    socialLinks: [
                        {
                            name: 'Blog',
                            url: '#',
                            icon: 'fab fa-bilibili'
                        },
                        {
                            name: 'Github',
                            url: '#',
                            icon: 'fab fa-github'
                        }
                    ]
                });

                // 当前时间
                const hours = ref('00');
                const minutes = ref('00');
                const seconds = ref('00');

                // 获取网站配置
                const fetchSiteConfig = async () => {
                    try {
                        const response = await axios.get('/site-config');

                        siteConfig.value = response.data;

                        // 更新页面标题和meta信息
                        document.title = response.data.title;
                        document.querySelector('meta[name="description"]').setAttribute('content', response.data.description);
                        document.querySelector('meta[name="keywords"]').setAttribute('content', response.data.keywords);
                    } catch (err) {
                        console.error('获取网站配置失败:', err);
                    }
                };

                // 更新当前时间
                const updateCurrentTime = () => {
                    const now = new Date();
                    hours.value = now.getHours().toString().padStart(2, '0');
                    minutes.value = now.getMinutes().toString().padStart(2, '0');
                    seconds.value = now.getSeconds().toString().padStart(2, '0');
                };

                // 切换留言表单折叠状态
                const toggleCommentForm = () => {
                    commentFormCollapsed.value = !commentFormCollapsed.value;
                };

                const comments = ref([]);
                const loading = ref(true);
                const error = ref(null);

                // 新留言表单
                const newComment = ref({
                    nickname: '',
                    blog: '',
                    avatar: '',
                    content: ''
                });

                const errors = ref({
                    nickname: '',
                    content: '',
                    avatar: ''
                });

                const submitting = ref(false);
                const submitSuccess = ref(false);

                // 获取留言数据
                const fetchComments = async () => {
                    try {
                        const response = await axios.get('/comments');

                        // 将获取的数据按时间倒序排列（最新的在前）
                        comments.value = response.data.sort((a, b) => {
                            return new Date(b.time) - new Date(a.time);
                        });

                        loading.value = false;
                    } catch (err) {
                        error.value = '加载留言失败: ' + (err.message || '请稍后再试');
                        loading.value = false;

                        // 错误就设置成空
                        comments.value = [];
                        loading.value = false;
                    }
                };

                // 格式化时间
                const formatTime = (timeString) => {
                    const date = new Date(timeString);
                    return date.toLocaleString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                };

                // 表单验证
                const validateForm = () => {
                    let valid = true;
                    errors.value = { nickname: '', content: '', avatar: '' };

                    if (!newComment.value.nickname.trim()) {
                        errors.value.nickname = '请输入昵称';
                        valid = false;
                    }

                    if (!newComment.value.content.trim()) {
                        errors.value.content = '请输入留言内容';
                        valid = false;
                    }

                    if (newComment.value.avatar && !isValidUrl(newComment.value.avatar)) {
                        errors.value.avatar = '请输入有效的URL地址';
                        valid = false;
                    }

                    return valid;
                };

                // URL验证函数
                const isValidUrl = (url) => {
                    try {
                        new URL(url);
                        return true;
                    } catch (e) {
                        return false;
                    }
                };

                // 提交留言
                const submitComment = async () => {
                    if (!validateForm()) return;

                    submitting.value = true;
                    submitSuccess.value = false;

                    try {
                        // 构建要提交的数据
                        const commentData = {
                            ...newComment.value,
                            time: new Date().toISOString()
                        };

                        // 提交留言
                        const response = await axios.post('/new-comment', commentData);

                        // 将新留言添加到列表开头
                        comments.value.unshift(response.data);

                        // 清空表单
                        newComment.value = {
                            nickname: '',
                            blog: '',
                            avatar: '',
                            content: ''
                        };

                        submitSuccess.value = true;

                        // 提交成功后折叠表单
                        commentFormCollapsed.value = true;

                        // 3秒后隐藏成功消息
                        setTimeout(() => {
                            submitSuccess.value = false;
                        }, 3000);
                    } catch (err) {
                        error.value = '提交留言失败: ' + (err.message || '请稍后再试');
                    } finally {
                        submitting.value = false;
                    }
                };

                const fetchHikotoko = async () => {
                    try {
                        const response = await fetch('https://v1.hitokoto.cn');
                        const data = await response.json();
                        const hitokotoElement = document.getElementById('hitokoto');
                        hitokotoElement.innerText = `${data.hitokoto} —— ${data.from}`;
                    } catch (error) {
                        console.error('获取一言失败:', error);
                        const hitokotoElement = document.getElementById('hitokoto');
                        hitokotoElement.innerText = '平凡是生活的底色，但每个人都可以为它增添自己的色彩';
                    }
                };

                onMounted(() => {
                    // 初始化当前时间
                    updateCurrentTime();

                    // 每秒更新一次时间
                    setInterval(updateCurrentTime, 1000);

                    // 获取留言
                    fetchComments();

                    // 获取一言
                    fetchHikotoko();

                    // 获取网站配置
                    fetchSiteConfig();
                });

                return {
                    hours,
                    minutes,
                    seconds,
                    comments,
                    loading,
                    error,
                    newComment,
                    errors,
                    submitting,
                    submitSuccess,
                    formatTime,
                    submitComment,
                    commentFormCollapsed,
                    toggleCommentForm,
                    siteConfig
                };
            }
        }).mount('#app');
    </script>
</body>

</html>